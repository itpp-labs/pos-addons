<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright 2015-2018 Ivan Yelizariev <https://it-projects.info/team/yelizariev>
     Copyright 2017-2018 Dinar Gabbasov <https://it-projects.info/team/GabbasovDinar>
     Copyright 2017 Kolushov Alexandr <https://it-projects.info/team/KolushovAlexandr>
     Copyright 2018 David Arnold
     License LGPL-3.0 or later (https://www.gnu.org/licenses/lgpl.html). -->

<odoo>
    <template id="point_of_sale_assets" name="pos_multi_session assets" inherit_id="point_of_sale.assets">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/pos_multi_session/static/src/js/pos_multi_session.js"></script>
            <link rel="stylesheet" href="/pos_multi_session/static/src/css/pos_multi_session.css"/>
        </xpath>
    </template>

    <template id="assets_backend" name="pos_multi_session backend_assets" inherit_id="web.assets_backend">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/pos_multi_session/static/src/js/test_pos_multi_session.js"></script>
        </xpath>
    </template>

    <record id="view_pos_multi_session_sync_order_form" model="ir.ui.view">
        <field name="name">pos_multi_session_sync.order.form</field>
        <field name="model">pos_multi_session_sync.order</field>
        <field name="arch" type="xml">
            <form string="POS Multi-Session Sync Orders" create="false" edit="false" delete="false">
                <header>
                    <button name="action_pos_multi_session_restore_order" string="Restore" type="object" states="deleted"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,paid,deleted" />
                </header>
                <sheet>
                    <group col="4" colspan="4">
                        <field name="order_uid"/>
                        <field name="write_date"/>
                        <field name="revision_ID"/>
                        <field name="multi_session_ID"/>
                        <field name="pos_session_ID"/>
                        <field name="run_ID"/>
                    </group>
                    <group>
                        <field name="order"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_pos_multi_session_sync_order_tree" model="ir.ui.view">
        <field name="name">pos_multi_session_sync.order.tree</field>
        <field name="model">pos_multi_session_sync.order</field>
        <field name="arch" type="xml">
            <tree create="0">
                <field name="order_uid"/>
                <field name="write_date"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="view_pos_multi_session_sync_order_filter" model="ir.ui.view">
        <field name="name">pos_multi_session_sync.order.filter</field>
        <field name="model">pos_multi_session_sync.order</field>
        <field name="arch" type="xml">
            <search string="Search POS Multi-Session Order">
                <field name="state"/>
                <filter name="paid" string="Paid" domain="[('state','=','paid')]"/>
                <filter name="new" string="New" domain="[('state','=','draft')]"/>
                <filter name="deleted" string="Deleted" domain="[('state','=','deleted')]"/>
                <filter name="unpaid" string="Unpaid" domain="[('state','=','unpaid')]"/>
            </search>
        </field>
    </record>

    <record id="action_pos_multi_session_sync_order" model="ir.actions.act_window">
        <field name="name">Multi Session Orders</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">pos_multi_session_sync.order</field>
        <field name="view_type">form</field>
        <field name="view_id" ref="view_pos_multi_session_sync_order_tree"/>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_deleted': 1}
        </field>
    </record>

    <menuitem id="menu_multi_session_orders"
              parent="point_of_sale.menu_point_of_sale"
              action="action_pos_multi_session_sync_order"
              sequence="99"
              groups="base.group_no_one"/>


    <record model="ir.ui.view" id="view_pos_config_form">
        <field name="name">pos.config.form.view.inherit</field>
        <field name="model">pos.config</field>
        <field name="inherit_id" ref="point_of_sale.view_pos_config_form"/>
        <field name="arch" type="xml">
            <xpath expr="//group[@name='features']" position="after">
                <group string="Multi-session" name="multi_session">
                    <group>
                        <field name="current_session_state" class="oe_edit_only" readonly="1" attrs="{'invisible':[('current_session_state', '!=', 'opened')]}"/>
                        <field name="multi_session_id" required="1" attrs="{'readonly':[('current_session_state', '=', 'opened')]}"></field>
                        <field name="multi_session_accept_incoming_orders"/>
                        <field name="multi_session_replace_empty_order" attrs="{'invisible':[('multi_session_accept_incoming_orders', '=', False)]}"/>
                        <field name="multi_session_deactivate_empty_order" attrs="{'invisible':['|',('multi_session_replace_empty_order', '=', True),('multi_session_accept_incoming_orders', '=', False)]}"/>
                    </group>
                    <group>
                        <p class="oe_edit_only" attrs="{'invisible':[('current_session_state', '!=', 'opened')]}"> You need to close current session to be able modify Multi-session value </p>
                    </group>
                </group>
            </xpath>
            <xpath expr="//field[@name='longpolling_max_silence_timeout']" position="before">
                <field name="sync_server"  placeholder="http://yourhost"/>
            </xpath>
        </field>
    </record>

    <record id="view_pos_config_kanban" model="ir.ui.view">
        <field name="name">pos.config.kanban.view</field>
        <field name="model">pos.config</field>
        <field name="inherit_id" ref="point_of_sale.view_pos_config_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='currency_id']" position="after">
                <field name="multi_session_id"/>
            </xpath>

            <xpath expr="//div[@class='o_primary']" position="inside">
                <t t-esc=" record.multi_session_id.value and ' (' + record.multi_session_id.value + ')' or ''"/>
            </xpath>
        </field>
    </record>

    <record model="ir.ui.view" id="view_pos_config_search">
        <field name="name">pos.config.search.view.inherit</field>
        <field name="model">pos.config</field>
        <field name="inherit_id" ref="point_of_sale.view_pos_config_search"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='stock_location_id']" position="after">
                <group string="Multi-session" name="multi_session" expand="0">
                    <field name="multi_session_id"/>
                    <filter name="multi_session_id" string="Multi-session" domain="[]" context="{'group_by': 'multi_session_id'}" />
                </group>
            </xpath>
        </field>
    </record>
</odoo>
